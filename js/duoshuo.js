!function(e,t,s){function a(){return c.short_name?g+"//"+c.short_name+"."+S.DOMAIN:S.REMOTE}function r(){function t(){for(var t;t=_.shift();){var a=t.url,r=new s(t.title,{dir:"auto",icon:t.iconUrl,body:t.body});try{r.onclick=function(){e.focus(),h.href=a,r.close()}}catch(e){}setTimeout((function(){r.close&&r.close()}),8e3)}}var s=e.Notification;"Notification"in e&&"denied"!==s.permission&&("granted"===s.permission&&t(),s.requestPermission((function(e){"granted"===e&&t()})))}function i(){return 0==ne.data.user_id}function n(e){S.theme=e,"none"!=e&&o.injectStylesheet(S.STATIC_URL+"/styles/embed"+(e?"."+e+".css?"+M[e]:"."+short_name)+".css")}var o={},d=t.getElementsByTagName("head")[0]||t.getElementsByTagName("body")[0];if(o.extend=function(e,t){for(var s in t)e[s]=t[s];return e},o.injectScript=function(a,r){var i=t.createElement("script"),n=t.head||t.getElementsByTagName("head")[0]||t.documentElement;i.type="text/javascript",i.src=a,i.async="async",i.charset="utf-8",r&&(i.onload=i.onreadystatechange=function(t,a){(a||!i.readyState||/loaded|complete/.test(i.readyState))&&(i.onload=i.onreadystatechange=null,n&&i.parentNode&&n.removeChild(i),i=s,a||r.call(e))}),n.insertBefore(i,n.firstChild)},o.injectStylesheet=function(e){var s=t.createElement("link");s.type="text/css",s.rel="stylesheet",s.href=e,d.appendChild(s)},o.injectStyle=function(e){var s=t.createElement("style");return s.type="text/css",d.appendChild(s),e=e.replace(/\}/g,"}\n"),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(t.createTextNode(e)),s},o.getCookie=function(e){for(var a,r,i,n=" "+e+"=",o=t.cookie.split(";"),d=0;d<o.length;d++)if((r=(a=" "+o[d]).indexOf(n))>=0&&r+n.length==(i=a.indexOf("=")+1))return decodeURIComponent(a.substring(i,a.length).replace(/\+/g,""));return s},o.param=function(e){var t=[];for(var a in e)e[a]!=s&&t.push(a+"="+encodeURIComponent(e[a]));return t.join("&")},o.cssProperty=function(e,s){var a=(t.body||t.documentElement).style;if(void 0===a)return!1;if("string"==typeof a[e])return!s||e;for(var r=["Moz","Webkit","ms"],i=(e=e.charAt(0).toUpperCase()+e.substr(1),0);i<r.length;i++)if("string"==typeof a[r[i]+e])return!s||r[i]+e},!e.DUOSHUO){for(var l in Object.prototype)return alert("Object.prototype 不为空，请不要给 Object.prototype 设置方法");var c,u,p=e.JSON,h=e.location,m=e.XMLHttpRequest,f=p&&p.stringify&&e.localStorage,v=e.navigator.userAgent,g="https:"==t.location.protocol?"https:":"http:",b=0,_=[],y=u=function(){function e(e){return t[e]||"&amp;"}var t={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},s=/&(?!\w+;)|[<>"'`]/g,a=/[&<>"'`]/;return function(t){return null==t||!1===t?"":a.test(t)?t.replace(s,e):t}}(),k=function(e){if(e.match(/^(http|https):/))return e;var s=t.createElement("a");return s.href=e,O.hrefNormalized?s.href:s.getAttribute("href",4)},x=function(e){return function(){return e}},w=function(){for(var e={},t=0;t<arguments.length;t++)arguments[t]&&o.extend(e,arguments[t]);var s=o.param(e);return s?"?"+s:""},T=function(){var e=o.getCookie("duoshuo_token");return e?{jwt:e}:c.remote_auth?{short_name:c.short_name,remote_auth:c.remote_auth}:s},q=function(){if(!c&&(c=e.duoshuoQuery)){if(!c.short_name||"your_duoshuo_short_name"===c.short_name)return c=s,void alert("你还没有设置多说域名(duoshuoQuery.short_name)，填入已有域名或创建新站点：http://duoshuo.com/create-site/");re.trigger("queryDefined")}return c},C=function(e){return e&&e.error&&e.warn?e:{error:function(){},log:function(){},warn:function(){}}}(e.console),S=e.DUOSHUO={sourceName:{weibo:"新浪微博",qq:"QQ",qzone:"QQ空间",qqt:"腾讯微博",renren:"人人网",douban:"豆瓣网",kaixin:"开心网",sohu:"搜狐微博",baidu:"百度",google:"谷歌",wechat:"微信",weixin:"微信",facebook:"Facebook",twitter:"Twitter",linkedin:"Linkedin"},serviceNames:{weibo:"微博",qq:"QQ",douban:"豆瓣",renren:"人人",kaixin:"开心",baidu:"百度",google:"谷歌",wechat:"微信",weixin:"微信",facebook:"Facebook",twitter:"Twitter",linkedin:"Linkedin"},parseDate:function(e){return e.parse("2011-10-28T00:00:00+08:00")&&function(t){return new e(t)}||e.parse("2011/10/28T00:00:00+0800")&&function(t){return new e(t.replace(/-/g,"/").replace(/:(\d\d)$/,"$1"))}||e.parse("2011/10/28 00:00:00+0800")&&function(t){return new e(t.replace(/-/g,"/").replace(/:(\d\d)$/,"$1").replace("T"," "))}||function(t){return new e(t)}}(Date),fullTime:function(e){var t=S.parseDate(e);return t.getFullYear()+"年"+(t.getMonth()+1)+"月"+t.getDate()+"日 "+t.toLocaleTimeString()},elapsedTime:function(e){var t=S.parseDate(e),s=new Date,a=(s-b-t)/1e3;return 10>a?"刚刚":60>a?Math.round(a)+"秒前":3600>a?Math.round(a/60)+"分钟前":86400>a?Math.round(a/3600)+"小时前":(s.getFullYear()==t.getFullYear()?"":t.getFullYear()+"年")+(t.getMonth()+1)+"月"+t.getDate()+"日"},compileStyle:function(e){var t="",s={textbox:"#ds-thread #ds-reset .ds-replybox .ds-textarea-wrapper"};if(!e)return t;for(var a in e)t+=s[a]+"{"+e[a]+"}\n";return t},init:function(e,t){e&&!P[e]&&(P[e]=t||{type:"EmbedThread"}),S.initView&&S.initView()}},j=t.all,O=S.support=function(){var s=t.createElement("div");s.innerHTML='<a href="/a" style="opacity:.55;">a</a><input type="checkbox"/>';var a=s.getElementsByTagName("a")[0],r={placeholder:"placeholder"in s.getElementsByTagName("input")[0],touch:"ontouchstart"in e||"onmsgesturechange"in e,opacity:/^0.55$/.test(a.style.opacity),hrefNormalized:"/a"===a.getAttribute("href"),iOS:v.match(/ \((iPad|iPhone|iPod);( U;)? CPU( iPhone)? OS /),android:v.match(/ \(Linux; U; Android /)};return r.ie6=!m&&void 0===s.style.maxHeight,r.authInWin=e.postMessage&&e.screen.width>800&&!r.iOS&&!r.android&&h.origin,r}(),P=S.selectors={".ds-thread":{type:"EmbedThread"},".ds-recent-comments":{type:"RecentComments"},".ds-recent-visitors":{type:"RecentVisitors"},".ds-top-users":{type:"TopUsers"},".ds-top-threads":{type:"TopThreads"},".ds-login":{type:"LoginWidget"},".ds-thread-count":{type:"ThreadCount"},".ds-share":{type:"ShareWidget"}},E=S.openDialog=function(e){return S.dialog!==s&&S.dialog.el.remove(),S.dialog=new se.Dialog(ee.dialog(e)).open()},L=S.smilies={};S.require=function(){function t(e){var t=U[e]?"?"+U[e]+".js":"";return S.STATIC_URL+"/libs/"+e+".js"+t}var s={mzadxN:"undefined"!=typeof mzadxN};return"undefined"!=typeof jQuery&&jQuery.fn.jquery>="1.5"&&(s["embed.compat"]=!0,S.jQuery=e.jQuery),function(e,a){if("string"==typeof e)s[e]?a():o.injectScript(t(e),(function(){s[e]=!0,a()}));else if("object"==typeof e){var r,i=!0;for(r=0;r<e.length;r++)!function(n){s[e[r]]||(i=!1,o.injectScript(t(n),(function(){s[n]=!0;for(var t=0;t<e.length;t++)if(!s[e[t]])return;a()})))}(e[r]);i&&a()}}}();for(var N=0,I=["EmbedThread","RecentComments","RecentVisitors","TopUsers","TopThreads","LoginWidget","ThreadCount"];N<I.length;N++)S[I[N]]=function(e){return function(t,s){(s=s||{}).type=e,t&&!P[t]&&(P[t]=s),S.initSelector&&S.initSelector(t,s)}}(I[N]),S["create"+I[N]]=function(e){return function(s,a){var r=t.createElement(s);for(var i in a)r.setAttribute("data-"+i,a[i]);return S[e](r),r}}(I[N]);S.RecentCommentsWidget=S.RecentComments;var z=S.API={ajax:function(e,t,r,i,n){function d(e,t,s){var a,r,o=t;if(e>=200&&300>e||304===e)if(304===e)o="notmodified",r=!0;else try{a=p.parse(s),o="success",r=!0}catch(e){o="parsererror"}else{(!o||e)&&(o="error",0>e&&(e=0));try{a=p.parse(s)}catch(e){o="parsererror"}}r?i&&i(a):"parseerror"===o?C.error("解析错误: "+s):(C.error("出错啦("+a.code+"): "+a.errorMessage),n&&n(a),a.errorTrace&&C.error(a.errorTrace)),function(e){var t=e.getResponseHeader("Date");t&&(b=new Date-new Date(t))}(h)}var l=o.getCookie("duoshuo_token");if((r=r||{}).v=S.version,l?r.jwt=l:c.remote_auth&&(r.remote_auth=c.remote_auth),m&&p&&p.parse){var u,h=new m;if(h&&"withCredentials"in h)return h.open(e,a()+"/api/"+t+".json"+("GET"==e?"?"+o.param(r):""),!0),h.withCredentials=!0,h.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),h.send("GET"==e?null:o.param(r)),u=function(e,t){var a,r,i;try{if(u&&(t||4===h.readyState))if(u=s,t)4!==h.readyState&&h.abort();else{a=h.status,h.getAllResponseHeaders();try{i=h.responseText}catch(e){}try{r=h.statusText}catch(e){r=""}}}catch(e){t||d(-1,e)}i&&d(a,r,i)},void(4===h.readyState?u():h.onreadystatechange=u)}"GET"!=e&&(r._method="POST");var f="cb_"+Math.round(1e6*Math.random());z[f]=function(e){0===e.code?i&&i(e):(n&&n(e),C.error("出错啦("+e.code+"): "+e.errorMessage),e.errorTrace&&C.error(e.errorTrace))},r.callback="DUOSHUO.API['"+f+"']",o.injectScript(a()+"/api/"+t+".jsonp?"+o.param(r))},get:function(e,t,s,a){return this.ajax("GET",e,t,s,a)},post:function(e,t,s,a){return this.ajax("POST",e,t,s,a)}},A=S.ws={messages:[],send:function(s){if(!("WebSocket"in e)||!p)return!1;var a=this;if(a.messages.push(p.stringify(s)),!a.webSocket){var i="https:"===t.location.protocol?"wss://ws.duoshuo.com:8202/":"ws://ws.duoshuo.com:8201/",n=a.webSocket=new WebSocket(i);n.onopen=function(){var e;if(1===n.readyState)for(;e=a.messages.shift();)n.send(e)},n.onmessage=function(e){try{var t=p.parse(e.data)}catch(e){return}switch(t.type){case"post":for(var s,a=0;a<S.pagelets.length;a++)(s=S.pagelets[a]).threadId==t.thread_id&&s.onMessage(t);break;case"notification":_.push(t),r()}},e.addEventListener("beforeunload",(function(){n.close()}))}a.webSocket.onopen()}};S.DOMAIN="duoshuo.com",S.STATIC_URL=g+"//static.duoshuo.com",S.REMOTE=g+"//duoshuo.com",S.version="15.11.15";var M={default:"79dc948b",dark:"ddc346d8",bluebox:"0f0f035c",newhua:"dc453ca2"},U={"embed.compat":"24f8ca3f",smilies:"921e8eda"},R={post:"发布",posting:"正在发布",settings:"设置",reply:"回复",like:"顶",repost:"转发",report:"举报",delete:"删除",reply_to:"回复 ",reposts:"转发",comments:"评论",floor:"楼",latest:"最新",earliest:"最早",hottest:"最热",share_to:"分享到:",leave_a_message:"说点什么吧…",no_comments_yet:"还没有评论，沙发等你来抢",repost_reason:"请输入转发理由",hot_posts_title:"被顶起来的评论",comments_zero:"暂无评论",comments_one:"1条评论",comments_multiple:"{num}条评论",reposts_zero:"暂无转发",reposts_one:"1条转发",reposts_multiple:"{num}条转发",weibo_reposts_zero:"暂无新浪微博",weibo_reposts_one:"1条新浪微博",weibo_reposts_multiple:"{num}条新浪微博",qqt_reposts_zero:"暂无腾讯微博",qqt_reposts_one:"1条腾讯微博",qqt_reposts_multiple:"{num}条腾讯微博"},D={get:function(e){return f?f[e]:void 0},save:function(e,t){if(f)try{f.removeItem(e),f[e]=p.stringify(t),f.removeItem(e+":timestamp"),f[e+":timestamp"]=Math.floor((new Date-b)/1e3)}catch(e){}}},W=S.loadRequire=function(t){if(t.visitor&&(!ne.data&&t.visitor.user_id&&e.Notification&&A.send({logged_user_id:t.visitor.user_id}),ne.reset(t.visitor)),t.site&&(ie.reset(t.site),D.save("ds_site_"+c.short_name,t.site)),!S.theme&&ie.data.theme&&n(ie.data.theme),t.lang&&(o.extend(R,t.lang),D.save("ds_lang_"+c.short_name,t.lang)),t.stylesheets)for(var s=0;s<t.stylesheets.length;s++)o.injectStylesheet(t.stylesheets[s]);if(t.nonce&&(S.nonce=t.nonce),t.style&&o.injectStyle((t.style||"")+S.compileStyle(c.component_style)),t.unread&&oe.reset(t.unread),t.warnings)for(s=0;s<t.warnings.length;s++)C.warn(t.warnings[s])},H=0,B=S.Class=function(){};B.extend=function(e){function t(){!H&&this.init&&this.init.apply(this,arguments)}H=1;var s=new this;for(var a in H=0,e)s[a]=e[a];return t.prototype=s,t.prototype.constructor=t,t.extend=arguments.callee,t};var J=S.Event=B.extend({on:function(e,t){var a=this.handlers||(this.handlers={});return a[e]===s&&(a[e]=[]),a[e].push(t),this},trigger:function(e,t){var s=(this.handlers||(this.handlers={}))[e];if(s)for(var a=0;a<s.length&&!1!==s[a].call(this,t);a++);return this}}),Q=S.Widget=J.extend({init:function(e,t){this.el=e,this.options=t||{},this.render()},render:function(){},reset:function(){},load:function(e){if(0===e.code){W(e);var t=this.prepare(e);t.options=o.extend(this.options,e.options),this.onload(t)}else this.onError(e)},onload:function(e){this.el.html(ee[this.tmpl](e))},prepare:function(e){return e},onMessage:function(){},onError:function(e){C.error("出错啦("+e.code+"): "+e.errorMessage),e.errorTrace&&C.error(e.errorTrace)}}),$=S.Model=J.extend({init:function(e){this.data=e},reset:function(e){this.data=e,this.trigger("reset")},remove:function(e){this.data.splice(e,1),this.trigger("reset")},set:function(e,t){if(t===s)for(var a in e)this.data[a]=e[a];else this.data[e]=t;return this.trigger("reset"),this},toJSON:function(){return o.extend({},this.data)}}),V=$.extend({toJSON:function(){return o.extend({},this.data)}}),F=$.extend({toJSON:function(){var e=o.extend({},this.data);return e.theAuthor=ce[this.data.author_id]&&ce[this.data.author_id].data||this.data.author,e.parents=this.data.parents||[],e}}),G=$.extend({toJSON:function(){return o.extend({},this.data)}}),Y=function(e){this.model=e};Y.prototype.set=function(e){for(var t in e)e[t]&&(this[t]?this[t].set(e[t]):this[t]=new this.model(e[t]))},Y.prototype.get=function(e){for(var t=0,s=[];t<e.length;t++)s[t]=this[e[t]];return s},Y.prototype.getJSON=function(e){for(var t=0,s=[];t<e.length;t++)this[e[t]]&&s.push(this[e[t]].toJSON());return s};var Z={userUrl:function(e){return e.url},avatarUrl:function(e){return"https:"==document.location.protocol&&(e.avatar_url?(e.avatar_url=e.avatar_url.replace(/^http\:\/\//,"https://"),e.avatar_url=e.avatar_url.replace(/himg\.bdimg\.com/,"nzriuc44h.qnssl.com"),e.avatar_url=e.avatar_url.replace(/ds\.cdncache\.org/,"nzrisok3d.qnssl.com"),e.avatar_url=e.avatar_url.replace(/img\.kaixin001\.com\.cn/,"nzrktdox3.qnssl.com"),e.avatar_url=e.avatar_url.replace(/img\d+\.douban\.com/,"img1.doubanio.com"),e.avatar_url=e.avatar_url.replace(/app\.qlogo\.cn/,"nzvcelvwu.qnssl.com"),e.avatar_url=e.avatar_url.replace(/wx\.qlogo\.cn/,"nzwsf9aei.qnssl.com"),e.avatar_url=e.avatar_url.replace(/tp\d+\.sinaimg\.cn/,"odfhb4m72.qnssl.com"),e.avatar_url=e.avatar_url.replace("img.t.sinajs.cn","nznlz6ohs.qnssl.com"),e.avatar_url=e.avatar_url.replace("0.gravatar.com/avatar","cdn.v2ex.com/gravatar")):ie.data.default_avatar_url=ie.data.default_avatar_url.replace(/^http\:\/\//,"https://")),e.avatar_url||ie.data.default_avatar_url},loginUrl:function(e,t){return t||(t={}),c.sso&&c.sso.login&&(t.sso=1,t.redirect_uri=c.sso.login),a()+"/login/"+e+"/"+w(t)},bindUrl:function(e){return a()+"/bind/"+e+"/"+w(c.sso&&c.sso.login?{sso:1,redirect_uri:c.sso.login}:null,T())},logoutUrl:function(){return a()+"/logout/"+w(c.sso&&c.sso.logout?{sso:1,redirect_uri:c.sso.logout}:null)}},X=["weixin","weibo","qq","renren"],K=["douban","kaixin","baidu","google"],ee=S.templates={userAnchor:function(e){return e.url?'<a rel="nofollow author" target="_blank" href="'+y(e.url)+'">'+y(e.name)+"</a>":y(e.name)},avatarImg:function(e,t){return'<img src="'+y(Z.avatarUrl(e,t))+'" alt="'+y(e.name)+'"'+(t?' style="width:'+t+"px;height:"+t+'px"':"")+"/>"},avatar:function(e,t){var s=ee.avatarImg(e,t),r=Z.userUrl(e);return r?'<a rel="nofollow author" target="_blank" href="'+y(r)+'" '+(e.user_id?" onclick=\"this.href='"+a()+"/user-url/?user_id="+e.user_id+"';\"":"")+' title="'+y(e.name)+'">'+s+"</a>":s},timeText:function(e){return e?'<span class="ds-time" datetime="'+e+'" title="'+S.fullTime(e)+'">'+S.elapsedTime(e)+"</span>":""},timeAnchor:function(e,t){return e?'<a href="'+t+'" target="_blank" rel="nofollow" class="ds-time" datetime="'+e+'" title="'+S.fullTime(e)+'">'+S.elapsedTime(e)+"</a>":""},serviceIcon:function(e,t){return'<a href="javascript:void(0)" class="ds-service-icon'+(t?"-grey":"")+" ds-"+e+'" data-service="'+e+'" title="'+S.sourceName[e]+'"></a>'},poweredBy:function(e){return'<p class="ds-powered-by"><a href="http://duoshuo.com" target="_blank" rel="nofollow">'+y(e)+"</a></p>"},indicator:x('<div id="ds-indicator"></div>'),waitingImg:x('<div id="ds-waiting"></div>'),loginItem:function(e,t){return'<li>    <a href="'+Z[t?"bindUrl":"loginUrl"](e)+'" rel="nofollow" class="ds-service-link ds-'+e+'">'+S.serviceNames[e]+(ne.data.social_uid[e]?' <span class="ds-icon ds-icon-ok"></span>':"")+"</a></li>"}},te=function(e){var t=[];for(var s in e)t.push('<input type="hidden" name="'+s+'" value="'+y(e[s])+'" />');return t.join("\n")};ee.commentList=function(e){var t="",s=e.list;if(s)for(var a,r=-1,i=s.length-1;i>r;)a=s[r+=1],t+='<li class="ds-comment',e.options.show_avatars&&(t+=" ds-show-avatars"),t+='" data-post-id="'+a.post_id+'">',e.options.show_avatars&&(t+='<div class="ds-avatar">'+ee.avatar(a.theAuthor,e.options.avatar_size)+"</div>"),t+='<div class="ds-meta">'+ee.userAnchor(a.theAuthor),e.options.show_time&&(t+=ee.timeText(a.created_at)),t+="</div>",t+=e.options.show_title?'<div class="ds-thread-title">在 <a href="'+u(a.thread.url)+'#comments">'+u(a.thread.title)+'</a> 中评论</div><div class="ds-excerpt">'+a.message+"</div>":'<a class="ds-excerpt" title="'+a.thread.title+' 中的评论" href="'+u(a.thread.url)+'#comments">'+a.message+"</a>",t+="</li>";return t},ee.ctxPost=function(e){var t="";return e.post.message=e.post.message.replace(/src=(["|'])http:\/\//g,"src=$1//nznlz6ohs.qnssl.com/"),e.post.message=e.post.message.replace("img.t.sinajs.cn/",""),e.post&&(t+='<li class="ds-ctx-entry"',e.hidden&&(t+=' style="display:none"'),t+=' data-post-id="'+e.post.post_id+'"><div class="ds-avatar">'+ee.avatar(e.post.theAuthor||e.post.author)+'</div><div class="ds-ctx-body"><div class="ds-ctx-head">'+ee.userAnchor(e.post.theAuthor||e.post.author)+ee.timeAnchor(e.post.created_at,e.post.url),e.index>=0&&(t+='<div class="ds-ctx-nth" title="'+S.fullTime(e.post.created_at)+'">'+(e.index+1)+R.floor+"</div>"),t+='</div><div class="ds-ctx-content">'+e.post.message,e.index>=0&&(t+='　　　　　　　<div class="ds-comment-actions',e.post.vote>0&&(t+=" ds-post-liked"),t+='">'+ee.likePost(e.post)+'<a class="ds-post-repost" href="javascript:void(0);"><span class="ds-icon ds-icon-share"></span>'+R.repost+'</a><a class="ds-post-reply" href="javascript:void(0);"><span class="ds-icon ds-icon-reply"></span>'+R.reply+"</a></div>"),t+="</div></div></li>"),t},ee["dialog-anonymous"]=function(e){var t='<h2>社交帐号登录</h2><div class="ds-icons-32">',s=e.services;if(s)for(var a,r=-1,i=s.length-1;i>r;)t+='<a class="ds-'+(a=s[r+=1])+'" href="'+Z.loginUrl(a)+'">'+S.sourceName[a]+"</a>";return t+="</div>",e.options.deny_anonymous||(t+='<h2>作为游客留言</h2><form><div class="ds-control-group"><input type="text" name="author_name" id="ds-dialog-name" value="'+u(ne.data.name)+'" required /><label for="ds-dialog-name">名字(必填)</label></div>',e.options.require_guest_email&&(t+='<div class="ds-control-group"><input type="email" name="author_email" id="ds-dialog-email" value="'+u(ne.data.email)+'" required /><label for="ds-dialog-email">邮箱(必填)</label></div>'),e.options.require_guest_url&&(t+='<div class="ds-control-group"><input type="url" name="author_url" id="ds-dialog-url" placeholder="http://" value="'+u(ne.data.url)+'" /><label for="ds-dialog-url">网址(可选)</label></div>'),t+='<button type="submit">发布</button></form>'),t},ee["dialog-ask-for-auth"]=function(){return'<h2>社交帐号登录</h2><ul class="ds-service-list">'+ee.serviceList(X)+'</ul><ul class="ds-service-list ds-additional-services">'+ee.serviceList(K)+"</ul>"},ee["dialog-bind-more"]=function(){return'<h2>绑定更多帐号</h2><ul class="ds-service-list">'+ee.serviceBindList(X)+'</ul><ul class="ds-service-list ds-additional-services">'+ee.serviceBindList(K)+'</ul><div style="clear:both"></div>'},ee["dialog-qrcode"]=function(e){return'<h2>微信扫一扫，分享到朋友圈</h2><div class="ds-share-qrcode" style="text-align:center;"><img src="'+e.qrcode_url+'" alt="'+e.url+'"></div>'},ee["dialog-reposts"]=function(e){var t='<h2>转发到微博</h2><div class="ds-quote"><strong>@'+u(e.post.theAuthor.name)+"</strong>: "+e.post.message+"</div><form>"+te({post_id:e.post.post_id})+'<div class="ds-textarea-wrapper"><textarea name="message" title="Ctrl+Enter快捷提交" placeholder="'+u(R.repost_reason)+'">'+u(e.repostMessage)+'</textarea><pre class="ds-hidden-text"></pre>';return t+='</div><div class="ds-actions">',e.service?t+=te({"service[]":e.service}):(t+='<label><input type="checkbox" name="service[]" value="weibo"',ne.data.social_uid.weibo&&(t+=' checked="checked"'),t+=' /><span class="ds-service-icon ds-weibo"></span>新浪微博</label><label><input type="checkbox" name="service[]" value="qqt"',ne.data.social_uid.qq&&(t+=' checked="checked"'),t+=' /><span class="ds-service-icon ds-qqt"></span>腾讯微博</label>'),t+'<button type="submit">'+R.repost+"</button></div></form>"},ee.dialog=function(e){return'<div class="ds-dialog"><div class="ds-dialog-inner ds-rounded"><div class="ds-dialog-body">'+e+'</div><div class="ds-dialog-footer"><a href="http://duoshuo.com/" target="_blank" class="ds-logo"></a><span>社会化评论框</span></div><a class="ds-dialog-close" href="javascript:void(0)" title="关闭"></a></div></div>'},ee.hotPosts=function(e){var t='<div class="ds-header ds-gradient-bg">'+u(R.hot_posts_title)+"</div><ul>",s=e.list;if(s)for(var a,r=-1,i=s.length-1;i>r;)a=s[r+=1],t+=ee.post({post:a,options:e.options});return t+"</ul>"},ee.likePost=function(e){var t='<a class="ds-post-likes" href="javascript:void(0);"><span class="ds-icon ds-icon-like"></span>'+R.like;return e.likes>0&&(t+="("+e.likes+")"),t+"</a>"},ee.likeTooltip=function(e){var t='<div class="ds-like-tooltip ds-rounded"><p>很高兴你能喜欢，分享一下吧：</p><ul>';for(var s in e.services)t+='<li><a class="ds-share-to-'+s+" ds-service-link ds-"+s+'" href="'+a()+"/share-proxy/?"+o.param({service:s,thread_id:e.thread_id})+'">'+e.services[s]+"</a></li>";return t+'</ul><p class="ds-like-tooltip-footer"><a class="ds-like-tooltip-close">算了</a></p></div>'},ee.loginButtons=function(){return'<div class="ds-login-buttons"><p>社交帐号登录:</p><div class="ds-social-links"><ul class="ds-service-list">'+ee.serviceList(X)+'<li><a class="ds-more-services" href="javascript:void(0)">更多»</a></li></ul><ul class="ds-service-list ds-additional-services">'+ee.serviceList(K)+"</ul></div></div>"},ee.loginWidget=function(e){var t='<div class="ds-icons-32">',s=e;if(s)for(var a,r=-1,i=s.length-1;i>r;)t+='<a class="ds-'+(a=s[r+=1])+'" href="'+Z.loginUrl(a)+'">'+S.sourceName[a]+"</a>";return t+"</div>"},ee.meta=function(e){var t='<div class="ds-meta"><a href="javascript:void(0)" class="ds-like-thread-button ds-rounded';return e.user_vote>0&&(t+=" ds-thread-liked"),t+='"><span class="ds-icon ds-icon-heart"></span> <span class="ds-thread-like-text">',(t+=e.user_vote>0?"已喜欢":"喜欢")+'</span><span class="ds-thread-cancel-like">取消喜欢</span></a><span class="ds-like-panel"></span></div>'},ee.notify=function(e){var t='<div id="ds-reset"><a class="ds-logo" href="http://duoshuo.com/" target="_blank" title="多说"></a><ul class="ds-notify-unread"><li';return e.comments||(t+=' style="display:none;"'),t+='><a data-type="unread-comments" href="javascript:void(0);">你有'+e.comments+"条新回复</a></li><li",e.notifications||(t+=' style="display:none;"'),t+'><a data-type="unread-notifications" href="javascript:void(0);">你有'+e.notifications+"条系统消息</a></li></ul></div>"},ee.post=function(e){var t="",s=e.post,r=e.options,i=s.author;if("https:"==document.location.protocol&&"-1"==s.message.indexOf("static.duoshuo.com")&&(s.message=s.message.replace(/src=(["|'])http:\/\//g,"src=$1//nznlz6ohs.qnssl.com/")),"-1"!=s.message.indexOf("static.duoshuo.com")&&(s.message=s.message.replace(/src=(["|'])http:\/\//g,"src=$1https://")),s.message=s.message.replace(/_org.gif/g,"_thumb.gif"),t+='<li class="ds-post" data-post-id="'+s.post_id+'"><div class="ds-post-self" data-post-id="'+s.post_id+'" data-thread-id="'+s.thread_id+'" data-root-id="'+s.root_id+'" data-source="'+s.source+'"><div class="ds-avatar"',i.user_id&&(t+=' data-user-id="'+i.user_id+'"'),t+=">"+ee.avatar(i),S.sourceName[s.source]&&(t+=ee.serviceIcon(s.source)),t+='</div><div class="ds-comment-body"><div class="ds-comment-header">',i.url?(t+='<a class="ds-user-name ds-highlight" data-qqt-account="'+(i.qqt_account||"")+'" href="'+u(i.url)+'" ',i.user_id&&(t+=" onclick=\"this.href='"+a()+"/user-url/?user_id="+i.user_id+"';\""),t+=' rel="nofollow" target="_blank"',i.user_id&&(t+=' data-user-id="'+i.user_id+'"'),t+=">"+u(i.name)+"</a>"):(t+='<span class="ds-user-name"',i.user_id&&(t+=' data-user-id="'+i.user_id+'"'),t+=' data-qqt-account="'+(i.qqt_account||"")+'">'+u(i.name)+"</span>"),t+="</div>",1==r.max_depth&&r.show_context&&s.parents.length){t+='<ol id="ds-ctx">';var n=le.getJSON(s.parents);if(n)for(var o,d=-1,l=n.length-1;l>d;)o=n[d+=1],1==d&&s.parents.length>2&&(t+='<li class="ds-ctx-entry"><a href="javascript:void(0);" class="ds-expand">还有'+(s.parents.length-2)+"条评论</a></li>"),t+=ee.ctxPost({post:o,index:d,hidden:d&&d<s.parents.length-1});t+="</ol>"}if(t+="<p>",s.parents.length>=r.max_depth&&(!r.show_context||r.max_depth>1)&&s.parent_id&&le[s.parent_id]&&(t+='<a class="ds-comment-context" data-post-id="'+s.post_id+'" data-parent-id="'+s.parent_id+'">'+R.reply_to+u(le[s.parent_id].toJSON().author.name)+": </a>"),t+=s.message+'</p><div class="ds-comment-footer ds-comment-actions',s.vote>0&&(t+=" ds-post-liked"),t+='">',t+=s.url?ee.timeAnchor(s.created_at,s.url):ee.timeText(s.created_at),"duoshuo"==s.source?(t+='<a class="ds-post-reply" href="javascript:void(0);"><span class="ds-icon ds-icon-reply"></span>'+R.reply+"</a>"+ee.likePost(s)+'<a class="ds-post-repost" href="javascript:void(0);"><span class="ds-icon ds-icon-share"></span>'+R.repost+'</a><a class="ds-post-report" href="javascript:void(0);"><span class="ds-icon ds-icon-report"></span>'+R.report+"</a>",s.privileges.delete&&(t+='<a class="ds-post-delete" href="javascript:void(0);"><span class="ds-icon ds-icon-delete"></span>'+R.delete+"</a>")):("qqt"==s.source||"weibo"==s.source)&&(t+='<a class="ds-weibo-comments" href="javascript:void(0);">'+R.comments,s.type.match(/\-comment$/)||(t+='(<span class="ds-count">'+s.comments+"</span>)"),t+='</a><a class="ds-weibo-reposts" href="javascript:void(0);">'+R.reposts,s.type.match(/\-comment$/)||(t+='(<span class="ds-count">'+s.reposts+"</span>)"),t+="</a>"),t+="</div></div></div>",r.max_depth>1&&(s.childrenArray||s.children)&&"weibo"!=s.source&&"qqt"!=s.source){t+='<ul class="ds-children">';var c=le.getJSON(s.childrenArray||s.children);if(c){d=-1;for(var p=c.length-1;p>d;)s=c[d+=1],t+=ee.post({post:s,options:r})}t+="</ul>"}return t+"</li>"},ee.postListHead=function(e){var t='<div class="ds-comments-info"><div class="ds-sort"><a class="ds-order-desc">'+R.latest+'</a><a class="ds-order-asc">'+R.earliest+'</a><a class="ds-order-hot">'+R.hottest+'</a></div><ul class="ds-comments-tabs"><li class="ds-tab"><a class="ds-comments-tab-duoshuo ds-current" href="javascript:void(0);"></a></li>';return e.options.show_reposts&&e.thread.reposts&&(t+='<li class="ds-tab"><a class="ds-comments-tab-repost" href="javascript:void(0);"></a></li>'),t+=" ",e.options.show_weibo&&e.thread.weibo_reposts&&(t+='<li class="ds-tab"><a class="ds-comments-tab-weibo" href="javascript:void(0);"></a></li>'),t+=" ",e.options.show_qqt&&e.thread.qqt_reposts&&(t+='<li class="ds-tab"><a class="ds-comments-tab-qqt" href="javascript:void(0);"></a></li>'),t+"</ul></div>"},ee.recentVisitors=function(e){var t="",s=e.response;if(s)for(var a,r=-1,i=s.length-1;i>r;)a=s[r+=1],t+='<div class="ds-avatar">'+ee.avatar(a,e.options.avatar_size)+"</div>";return t},ee.replybox=function(e){var t='<div class="ds-replybox"><a class="ds-avatar"';if(t+=i()?' href="javascript:void(0);" onclick="return false"':' href="'+S.REMOTE+"/settings/avatar/"+w(T())+'" target="_blank" title="设置头像"',t+=">"+ee.avatarImg(ne.data)+'</a><form method="post">'+te(e.params)+'<div class="ds-textarea-wrapper ds-rounded-top"><textarea name="message" title="Ctrl+Enter快捷提交" placeholder="'+u(R.leave_a_message)+'"></textarea><pre class="ds-hidden-text"></pre>',t+="</div>",t+='<div class="ds-post-toolbar"><div class="ds-post-options ds-gradient-bg"><span class="ds-sync">',!i()&&ne.data.repostOptions)for(var s in t+='<input id="ds-sync-checkbox',e.inline&&(t+="-inline"),t+='" type="checkbox" name="repost" ',e.checked&&(t+='checked="checked" '),t+='value="'+e.repostArray.join(",")+'"> <label for="ds-sync-checkbox',e.inline&&(t+="-inline"),t+='">'+R.share_to+"</label>",ne.data.repostOptions)t+=ee.serviceIcon(s,!ne.data.repostOptions[s]);return t+="</span>",t+="</div>",t+='<button class="ds-post-button" type="submit">'+u(R.post)+'</button><div class="ds-toolbar-buttons">',e.options.use_smilies&&(t+='<a class="ds-toolbar-button ds-add-emote" title="插入表情"></a>'),e.options.use_images&&e.options.parse_html_enabled&&(t+='<a class="ds-toolbar-button ds-add-image" title="插入图片"></a>'),(t+="</div></div>")+"</form></div>"},ee.serviceBindList=function(e){var t="",s=e;if(s)for(var a,r=-1,i=s.length-1;i>r;)a=s[r+=1],t+='<li><a href="'+Z.bindUrl(a)+'" rel="nofollow" class="ds-service-link ds-'+a+'">'+S.serviceNames[a],ne.data.social_uid[a]&&(t+=' <span class="ds-icon ds-icon-ok"></span>'),t+="</a></li>";return t},ee.serviceList=function(e){var t="",s=e;if(s)for(var a,r=-1,i=s.length-1;i>r;)a=s[r+=1],t+='<li><a href="'+Z.loginUrl(a)+'" rel="nofollow" class="ds-service-link ds-'+a+'">'+S.serviceNames[a]+"</a></li>";return t},ee.shareWidget=function(e){var t='<div class="ds-share-icons"> <div class="ds-share-icons-inner"> <ul class="ds-share-icons-16"> ',s=e.services;if(s)for(var a,r=-1,i=s.length-1;i>r;)t+=' <li> <a class="ds-'+(a=s[r+=1])+'" href="javascript:void(0);" data-service="'+a+'">'+S.sourceName[a]+"</a> </li> ";return t+' </ul> </div> <div class="ds-share-icons-footer">'+e.copyright+"</div></div>"},ee.smiliesTooltip=function(e){var t='<div id="ds-smilies-tooltip"><ul class="ds-smilies-tabs">';for(var s in e)t+="<li><a>"+s+"</a></li>";return t+'</ul><div class="ds-smilies-container"></div></div>'},ee.toolbar=function(){var e='<div class="ds-toolbar"><div class="ds-account-control"><span class="ds-icon ds-icon-settings"></span> <span>帐号管理</span><ul><li><a class="ds-bind-more" href="javascript:void(0);" style="border-top: none">绑定更多</a></li><li><a target="_blank" href="'+S.REMOTE+"/settings/"+w(T())+'">'+u(R.settings)+'</a></li><li><a rel="nofollow" href="'+Z.logoutUrl()+'" style="border-bottom: none">登出</a></li></ul></div><div class="ds-visitor">';return(e+=ne.data.url?'<a class="ds-visitor-name" href="'+u(ne.data.url)+'" target="_blank">'+u(ne.data.name)+"</a>":'<span class="ds-visitor-name">'+u(ne.data.name)+"</span>")+'<a class="ds-unread-comments-count" href="javascript:void(0);" title="新回复"></a></div></div>'},ee.topThreads=function(e){var t="",s=e.response;if(s)for(var a,r=-1,i=s.length-1;i>r;)a=s[r+=1],t+='<li><a target="_blank" href="'+u(a.url)+'" title="'+u(a.title)+'">'+u(a.title)+"</a></li>";return t},ee.topUsers=function(e){var t="",s=e.response;if(s)for(var a,r=-1,i=s.length-1;i>r;)a=s[r+=1],t+='<div class="ds-avatar">'+ee.avatar(a,e.options.avatar_size)+"<h4>"+u(a.name)+"</h4></div>";return t},ee.userInfo=function(e){var t='<a href="'+u(e.url)+'" onclick="this.href=\''+a()+"/user-url/?user_id="+e.user_id+'\';" class="ds-avatar" target="_blank">'+ee.avatarImg(e)+'</a><a href="'+u(e.url)+'" onclick="this.href=\''+a()+"/user-url/?user_id="+e.user_id+'\';" class="ds-user-name ds-highlight" target="_blank">'+u(e.name)+"</a>";for(var s in e.social_uid)t+='<a href="'+S.REMOTE+"/user-proxy/"+s+"/"+e.social_uid[s]+'/" target="_blank" class="ds-service-icon ds-'+s+'" title="'+S.sourceName[s]+'"></a>';return t+='<p class="ds-user-card-meta"><a href="'+S.REMOTE+"/profile/"+e.user_id+'/" target="_blank"><span class="ds-highlight">'+e.comments+"</span>条评论</a></p>",e.description&&(t+='<p class="ds-user-description">'+u(e.description)+"</p>"),t};var se=S.Views={},ae=(S.Callbacks={},S.pagelets=[]),re=S.events=new J,ie=S.site=new $,ne=S.visitor=new V,oe=S.unread=new $,de=S.threadPool=new Y(G),le=S.postPool=new Y(F),ce=S.userPool=new Y(V);re.on("queryDefined",(function(){var e=c.short_name;if(c.theme&&n(c.theme),f){var t=f["ds_site_"+e],s=f["ds_lang_"+e];t&&ie.reset(p.parse(t)),s&&o.extend(R,p.parse(s))}})),q(),S.require("embed.compat",(function(){function r(e){e.stopPropagation()}function n(e){(e.ctrlKey&&13==e.which||10==e.which)&&H(this.form).trigger("submit")}function d(){var e=H(this);e.height(Math.max(54,e.next(".ds-hidden-text").text(this.value).height()+27))}function l(){if(O.authInWin){var e=this.href.match(/\/(login|bind)\/(\w+)\//i);if(e&&S.serviceNames[e[2]])return!b(e[2],this.href)}}function u(){var e,s,a,r,i,n=this,o=0,d=0;t.selection&&(s=t.selection.createRange())&&s.parentElement()==n&&(r=n.value.length,e=n.value.replace(/\r\n/g,"\n"),(a=n.createTextRange()).moveToBookmark(s.getBookmark()),(i=n.createTextRange()).collapse(!1),a.compareEndPoints("StartToEnd",i)>-1?o=d=r:(o=-a.moveStart("character",-r),o+=e.slice(0,o).split("\n").length-1,a.compareEndPoints("EndToEnd",i)>-1?d=r:(d=-a.moveEnd("character",-r),d+=e.slice(0,d).split("\n").length-1))),H(n).data("ds-range-start",o).data("ds-range-end",d)}function p(e){return O.touch&&e.addClass("ds-touch"),o.cssProperty("transition")||e.addClass("ds-no-transition"),O.ie6&&e.addClass("ds-ie6"),O.opacity||e.addClass("ds-no-opacity"),e}function m(e){if(!O.placeholder){var t=e.attr("placeholder");e.val(t).focus((function(){this.value===t&&(this.value="")})).blur((function(){""===this.value&&(this.value=t)}))}return e}function g(e){"http://duoshuo.com"===e.origin&&"login"===e.data.type&&(h.href=e.data.redirectUrl)}function b(t,s){var a={weibo:[760,600],renren:[420,322],qq:[504,445],weixin:[450,550],google:[600,440]}[t]||[550,400];return e.open(s+(-1==s.indexOf("?")?"?":"&")+o.param({origin:h.origin||"http://"+h.host}),"_blank","width="+a[0]+",height="+a[1]+",toolbar=no,menubar=no,location=yes")}function _(e){var t=Z[i()?"loginUrl":"bindUrl"](e);O.authInWin&&b(e,t)||(h.href=t)}function x(e,t,s,a){var r=E(ee["dialog-reposts"]({post:e.toJSON(),repostMessage:t,service:a})),i=r.el.find("form");return i.submit((function(){return a||i.find("[type=checkbox]:checked")[0]?(z.post("posts/repost",S.toJSON(i),(function(e){if(s&&a){var t=s.options,r=I(s.postList.el,e.response[a],t);"asc"==t.order==("top"==t.formPosition)&&S.scrollTo(r);var i=s.el.find(".ds-comments-tab-"+a+" span.ds-highlight");i.html(parseInt(i.html())+1)}})),r.close(),!1):(alert("还没有选发布到哪儿呢"),!1)})),i.find(".ds-actions [type=checkbox]").change((function(){var e=this.value;return this.checked&&!ne.data.social_uid["qqt"==e?"qq":e]?void _(e):void 0})),m(i.find("textarea")).keyup(n).keyup(d).focus(),!1}function w(e){var t={"unread-comments":{title:"新留言及回复",apiUrl:"users/unreadComments",tmpl:function(e){return e.thread?'<li data-thread-id="'+e.thread.thread_id+'">'+H.map(e.authors,ee.userAnchor).join("、")+' 在 <a class="ds-read" href="'+e.thread.url+'#comments" target="_blank">'+y(e.thread.title||"无标题")+'</a> 中回复了你 <a class="ds-delete ds-read" title="知道了" href="javascript:void(0)">知道了</a></li>':""},read:function(e){var t=e.attr("data-thread-id");z.post("threads/read",{thread_id:t}),oe.data.comments--}},"unread-notifications":{title:"系统消息",apiUrl:"users/unreadNotifications",tmpl:function(e){return'<li data-notification-id="'+e.notification_id+'" data-notification-type="'+e.type+'">'+e.content+' <a class="ds-delete ds-read" title="知道了" href="javascript:void(0)">知道了</a></li>'},read:function(e){var t=e.attr("data-notification-id");z.post("notifications/read",{notification_id:t}),oe.data.notifications--}}}[e],s=E("<h2>"+t.title+'</h2><ul class="ds-unread-list"></ul>');s.on("close",S.resetNotify);var a=s.el.find(".ds-unread-list").delegate(".ds-delete","click",(function(){return H(this).parent().remove(),0===a.children().length&&s.close(),!1})).delegate(".ds-read","click",(function(){t.read(H(this).parent())}));H("#ds-notify").hide(),z.get(t.apiUrl,{},(function(e){s.el.find(".ds-unread-list").html(H.map(e.response,t.tmpl).join("\n"))}))}function T(){bubbleOutTimer&&(clearTimeout(bubbleOutTimer),bubbleOutTimer=0)}function N(){bubbleOutTimer=setTimeout((function(){bubbleOutTimer=0,Y.detach()}),400)}function I(e,t,s){return e.find(".ds-post[data-post-id="+t.data.post_id+"]")[0]?void 0:(e.find(".ds-post-placeholder").remove(),H(ee.post({post:t.toJSON(),options:s})).hide()["asc"==s.order?"appendTo":"prependTo"](e).slideDown((function(){})))}function M(e,t){var s;this.delegate("a.ds-post-likes","click",(function(){if(i())return E(ee["dialog-ask-for-auth"]({})).el.find(".ds-dialog").css("width","300px").find("a.ds-service-link").click(l),!1;var e=H(this).parent(),t=e.hasClass("ds-post-liked"),s=H(this).html().match(/\((\d+)\)/),a=(s?parseInt(s[1]):0)+(t?-1:1);return z.post("posts/vote",{post_id:e.closest(".ds-ctx-entry, .ds-post-self").attr("data-post-id"),vote:t?0:1}),H(this).html(H(this).html().replace(/\(\d+\)/,"")+(a?"("+a+")":"")),e[t?"removeClass":"addClass"]("ds-post-liked"),!1})).delegate("a.ds-post-repost","click",(function(){var e=H(this).closest(".ds-post-self");return x(le[e.attr("data-post-id")],""),!1})).delegate("a.ds-post-delete","click",(function(){if(!confirm("确定要删除这条评论吗？"))return!1;var t=H(this).closest(".ds-post-self");return z.post("posts/remove",{post_id:t.attr("data-post-id")}),t.parent().fadeOut(200,(function(){e.data.comments--,e.updateCounter("duoshuo"),H(this).remove()})),!1})).delegate("a.ds-post-report","click",(function(){if(!confirm("确定要举报这条评论吗？"))return!1;var e=H(this).closest(".ds-post-self");return z.post("posts/report",{post_id:e.attr("data-post-id")}),alert("感谢您的反馈！"),!1})).delegate("a.ds-post-reply","click",(function(){var a=H(this),r=a.closest(".ds-comment-actions");if(r.hasClass("ds-reply-active"))s.el.fadeOut(200,(function(){H(this).detach()})),r.removeClass("ds-reply-active");else{var i=a.closest(".ds-ctx-entry, .ds-post-self");s?s.actionsBar.removeClass("ds-reply-active"):(s=new se.Replybox(e)).render(!0).el.addClass("ds-inline-replybox").detach(),s.el.find("[name=parent_id]").val(i.attr("data-post-id")),s.el.show().appendTo(a.closest(".ds-ctx-body, .ds-comment-body")).find("textarea").focus(),s.actionsBar=r.addClass("ds-reply-active"),t.max_depth<=1?s.postList=e.postList.el:(s.postList=i.siblings(".ds-children"),s.postList[0]||(s.postList=H('<ul class="ds-children"></ul>').insertAfter(i)))}return!1})).delegate("a.ds-weibo-comments","click",(function(){var e=H(this).closest(".ds-post-self"),s=e.attr("data-post-id");if(e.data("source"),0!=e.attr("data-root-id"))return!1;var a=e.siblings(".ds-children");return a[0]?(a.remove(),!1):(a=H('<ul class="ds-children"></ul>').insertAfter(e),z.get("posts/listComments",U({post_id:s}),(function(e){W(e),a.append(H.map(e.response,(function(e){return ee.post({post:e,options:t})})).join(""))})),!1)})).delegate("a.ds-weibo-reposts","click",(function(){var t=H(this).closest(".ds-post-self"),s=le[t.attr("data-post-id")],a=s.data.source;if(ne.data.social_uid["qqt"==a?"qq":a]){var r=s.data.root_id,i="0"!=r?le[r]:s,n="";if("0"!=r){var o=prepatePost(s.data).theAuthor;n=("weibo"==a?"//@"+o.name:"|| @"+o.qqt_account)+":"+s.data.message}return x(i,n,e,a),!1}_(a)})).delegate("a.ds-expand","click",(function(){var e=H(this).parent();return e.siblings().show(),e.remove(),!1})),O.touch||this.delegate("a.ds-comment-context, .ds-avatar, .ds-user-name","mouseenter",(function(){var t=this;if(bubbleOutTimer&&Y.owner==t)return clearTimeout(bubbleOutTimer),void(bubbleOutTimer=0);var s=H(t);K=setTimeout((function(){K=0,Y.owner=t,T();var a=s.offset(),r=e.el.offset(),i=s.innerWidth()/2,n=e.el.innerHeight()-(a.top-r.top)+6,o=a.left-r.left-35+(i>35?35:i);try{if(s.hasClass("ds-comment-context"))X.attr("id","ds-ctx-bubble").attr("data-post-id",s.attr("data-post-id")).html('<ul id="ds-ctx">'+ee.ctxPost({post:le[s.attr("data-parent-id")].toJSON()})+'</ul><div class="ds-bubble-footer"><a class="ds-ctx-open" href="javascript:void(0);">查看对话</a></div>');else if(s.hasClass("ds-avatar")||s.hasClass("ds-user-name")){var d={},l=d.user_id=s.attr("data-user-id");if(!l)throw"no info";X.attr("id","ds-user-card").attr("data-user-id",l).empty(),ce[l]?X.html(ee.userInfo(ce[l].data)):z.get("users/profile",U(d),(function(e){var s=e.response;ce[l]?ce[l].set(s):ce[l]=new V(s),Y.owner==t&&X.html(ee.userInfo(s))}))}Y.css({bottom:n,left:o}).appendTo(e.innerEl)}catch(e){Y.detach()}}),200)})).delegate("a.ds-comment-context, .ds-avatar, .ds-user-name","mouseleave",(function(){K?(clearTimeout(K),K=0):bubbleOutTimer||N()}))}function U(e){var s={require:"site,visitor,nonce,lang"+(te++?"":",unread,log,extraCss"),site_ims:D.get("ds_site_"+c.short_name+":timestamp"),lang_ims:D.get("ds_lang_"+c.short_name+":timestamp"),referer:t.referrer};for(var a in c.stylePatch&&(s.style_patch=c.stylePatch),s)s[a]&&(!O.ie6||encodeURIComponent(s[a]).length<200)&&(e[a]=s[a]);return e}var H=S.jQuery,B=H(e),$=H(t);e.postMessage&&(e.addEventListener?e.addEventListener("message",g,!1):e.attachEvent&&e.attachEvent("onmessage",g)),S.scrollTo=function(e){var t=e.offset().top;(t<B.scrollTop()||t>B.scrollTop()+B.height())&&H("html, body").animate({scrollTop:t-40},200,"swing")},S.toJSON=function(e){var t=/\r?\n/g,s=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,a=/^(?:select|textarea)/i,r=e.map((function(){return this.elements?H.makeArray(this.elements):this})).filter((function(){return this.name&&!this.disabled&&(this.checked||a.test(this.nodeName)||s.test(this.type))})).map((function(e,s){var a=H(this).val();return null==a?null:H.isArray(a)?H.map(a,(function(e){return{name:s.name,value:e.replace(t,"\r\n")}})):{name:s.name,value:a.replace(t,"\r\n")}})).toArray(),i={};return H.each(r,(function(){i[this.name]=this.value})),i},S.resetNotify=function(){var e=H("#ds-notify"),s=oe.data;e[0]||(e=H('<div id="ds-notify"></div>').css({hidden:{display:"none"},"top-right":{top:"24px",right:"24px"},"bottom-right":{bottom:"24px",right:"24px"}}[ie.data.notify_position]).delegate(".ds-notify-unread a","click",(function(){return w(H(this).data("type")),!1})).appendTo(t.body)),e.html(ee.notify(s))[!s.comments&&!s.notifications||"hidden"===ie.data.notify_position||H(".ds-dialog")[0]?"hide":"show"]()},oe.on("reset",S.resetNotify),se.Replybox=function(e){this.embedThread=e},se.Replybox.prototype={render:function(e){function s(e){e.data("submitting",!1),e.find(".ds-post-button").removeClass("ds-waiting").html(R.post)[0].disabled=!1}var a=this,r=a.embedThread,o=r.options,c=function(){S.require("smilies",(function(){}))},p={thread:r,options:o,inline:e,params:{thread_id:r.threadId,parent_id:"",nonce:S.nonce},repostArray:[],checked:0};for(var h in ne.data.repostOptions)ne.data.repostOptions[h]&&(p.repostArray.push(h),p.checked=1);var v=a.el=H(ee.replybox(p)).click(c),g=v.find("form"),b=g.find("input[type=checkbox]")[0],_=g.find("a.ds-service-icon, a.ds-service-icon-grey"),y=m(g.find("textarea")).focus(c).keyup(n).keyup(d).bind("focus mousedown mouseup keyup",u),k=v.find(".ds-add-emote").click((function(e){var s=S.smiliesTooltip;return k.toggleClass("ds-expanded").hasClass("ds-expanded")?(s||((s=S.smiliesTooltip=new se.SmiliesTooltip).render(),S.require("smilies",(function(){s.reset("微博-默认")}))),s.replybox=a,s.el.appendTo(t.body).css({top:a.el.offset().top+a.el.outerHeight()+4+"px",left:a.el.find(".ds-textarea-wrapper").offset().left+"px"}),H(t.body).click(x)):x(e),!1})),x=(v.find(".ds-add-image").click((function(e){var s=y[0],a=s.value,r="请输入图片地址",i='<img src="'+r+'" />';if(t.selection){s.value=a.substring(0,y.data("ds-range-start"))+i+a.substring(y.data("ds-range-end"),a.length),s.value=s.value.replace("说点什么吧 ...",""),s.focus();var n=t.selection.createRange();n.collapse(),n.findText(r),n.select()}else{s.value=a.substring(0,s.selectionStart)+i+a.substring(s.selectionEnd);var o=s.value.search(r);s.setSelectionRange(o,o+r.length),s.focus()}e.preventDefault()})),a.hideSmilies=function(){k.removeClass("ds-expanded"),S.smiliesTooltip.el.detach(),H(t.body).unbind("click",x)}),w=function(e,t){var s=E(ee["dialog-anonymous"]({services:["weixin","weibo","qq","renren","kaixin","douban"],options:o}));if(s.el.find(".ds-dialog").css("width","320px").find(".ds-icons-32 a").click(l),!o.deny_anonymous){var a=s.el.find("form");a.submit((function(){var e=a.find("input[name=author_email]").val();return!e&&!o.require_guest_email||e.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)?(t(S.toJSON(a)),s.close(),!1):(alert("请输入一个有效的email地址."),!1)})),a.find("input[name=author_name]")[0].focus()}};o.deny_anonymous&&y.focus((function(){if(i()){w(0,T);var e=function(t){t.stopPropagation(),y.unbind("click",e)};y.click(e)}return!1}));var T=function(e){(function(e){e.data("submitting",!0),e.find(".ds-post-button").addClass("ds-waiting").html(R.posting)[0].disabled=!0})(g),z.post("posts/create",H.extend(S.toJSON(g),e),(function(e){var t=le[e.response.post_id]=new F(e.response),i=I(a.postList,t,o);if("asc"==o.order==("top"==o.formPosition)&&S.scrollTo(i),r.data.comments++,r.updateCounter("duoshuo"),y.val("").trigger("keyup"),s(g),v.hasClass("ds-inline-replybox")&&(v.detach(),a.actionsBar.removeClass("ds-reply-active")),f)try{f.removeItem("ds_draft_"+r.threadId)}catch(e){}}),(function(e){s(g),alert(e.errorMessage)}))};g.submit((function(){if(g.data("submitting"))return!1;var e=H.trim(g[0].message.value);return""==e||!O.placeholder&&e==y.attr("placeholder")?(alert("您还没写内容呢"),!1):(i()?w(0,T):T(),!1)}));var q=function(e){return H(e).hasClass("ds-service-icon-grey")?null:H(e).attr("data-service")};if(_.click((function(){return H(this).toggleClass("ds-service-icon-grey").toggleClass("ds-service-icon"),b.value=H.map(_,q).join(","),b.checked=""!=b.value,!1})),H(b).change((function(){var e=this.checked;_[e?"removeClass":"addClass"]("ds-service-icon-grey")[e?"addClass":"removeClass"]("ds-service-icon"),this.value=H.map(_,q).join(",")})),!e&&f){var C="ds_draft_"+r.threadId;y.bind("focus blur keyup",(function(e){var t=H(e.currentTarget).val();try{f[C]=t}catch(e){}})),f[C]&&y.val(f[C])}return this}},se.Dialog=J.extend({init:function(e,t){(this.el=H("#ds-wrapper"))[0]||(this.el=p(H('<div id="ds-wrapper"></div>'))),this.options=H.extend({width:600},t),e!==s&&H(e).attr("id","ds-reset").appendTo(this.el)},open:function(){function e(e){return 27==e.which?(a.close(),!1):void 0}function s(){return a.close(),!1}var a=this;return a.el.hide().appendTo(t.body).fadeIn(200),O.ie6&&a.el.css("top",B.scrollTop()+100),a.el.show().find(".ds-dialog").delegate("a.ds-dialog-close","click",(function(){return a.close(),!1})).click(r),$.keydown(e),H(t.body).click(s),a.close=function(){$.unbind("keydown",e),H(t.body).unbind("click",s),a.el.fadeOut(200,(function(){H(this).remove()})),a.trigger("close")},a}}),ee.likePanel=function(e){return e.likes?'<span class="ds-highlight">'+e.likes+"</span> 人喜欢":""},se.Meta=function(e){this.embedThread=e},se.Meta.prototype={render:function(){var a=this,n=a.embedThread.model,o=a.el=H(ee.meta(n.toJSON())),d=o.find(".ds-like-thread-button");return d.click((function(i){function l(){a.tooltip.detach(),H(t.body).unbind("click",l)}var c=d.hasClass("ds-thread-liked");if(z.post("threads/vote",{thread_id:a.embedThread.threadId,vote:c?0:1},(function(e){n.set(e),a.resetLikePanel()})),d.toggleClass("ds-thread-liked"),d.find(".ds-thread-like-text").text(c?"喜欢":"已喜欢"),c)return a.tooltip&&l(),!1;if(a.tooltip===s){var u=ee.likeTooltip({services:{qzone:"QQ空间",weibo:"新浪微博",qqt:"腾讯微博",renren:"人人网",kaixin:"开心网",douban:"豆瓣网",baidu:"百度搜藏"},thread_id:n.data.thread_id});a.tooltip=H(u).click(r).delegate("a","click",(function(t){if("ds-like-tooltip-close"===this.className)l();else if(!e.open(this.href,"_blank","height=500,width=600,top=0,left=0,toolbar=no,menubar=no,resizable=yes,location=yes,status=no"))return;return!1}))}var p={left:0};return p.top=o.position().top+o.outerHeight()-4+"px",a.tooltip.appendTo(a.embedThread.innerEl).css(p),H(t.body).click(l),!1})),a.resetLikePanel(),i()&&o.hide(),a},resetLikePanel:function(){this.el.find(".ds-like-panel").html(ee.likePanel(this.embedThread.model.toJSON()))}},se.PostListHead=function(e){this.embedThread=e},se.PostListHead.prototype={render:function(){var e=this.embedThread,t=e.postList,s=this.el=H(ee.postListHead({thread:e.model.toJSON(),options:e.options})),a=s.find("ul.ds-comments-tabs");a.delegate(".ds-tab a","click",(function(s){a.find("a.ds-current").removeClass("ds-current"),t.params.page=1;var r=s.currentTarget;switch(r.className){case"ds-comments-tab-duoshuo":t.params.source="duoshuo",e.replybox.el.show();break;case"ds-comments-tab-repost":t.params.source="repost",e.replybox.el.hide();break;case"ds-comments-tab-weibo":t.params.source="weibo",e.replybox.el.hide();break;case"ds-comments-tab-qqt":t.params.source="qqt",e.replybox.el.hide()}return H(r).addClass("ds-current"),t.refetch(),!1}));var r=s.find(".ds-sort");return r.delegate("a","click",(function(){return r.find("a.ds-current").removeClass("ds-current"),t.params.order=e.options.order=this.className.replace("ds-order-",""),t.params.page=1,t.refetch(),H(this).addClass("ds-current"),!1})),r.find(".ds-order-"+t.params.order).addClass("ds-current"),this}},se.Paginator=function(e){e=e||{};var t=this.el=e.el||H('<div class="ds-paginator"></div>'),s=this.collection=e.collection;t.delegate("a","click",(function(){return s.params.page=parseInt(this.innerHTML),s.refetch(),t.find(".ds-current").removeClass("ds-current"),H(this).addClass("ds-current"),!1}))},se.Paginator.prototype={reset:function(e){function t(e){r.push('<a data-page="'+e+'" href="javascript:void(0);">'+e+"</a>")}var s,a=this.collection.params.page||1,r=[];if(a>1)for(t(1),(s=a>4?a-2:2)>2&&r.push('<span class="page-break">...</span>');a>s;s++)t(s);if(r.push('<a data-page="'+a+'" href="javascript:void(0);" class="ds-current">'+a+"</a>"),a<e.pages){for(s=a+1;a+4>=s&&s<e.pages;s++)t(s);s<e.pages&&r.push('<span class="page-break">...</span>'),t(e.pages)}this.el.html('<div class="ds-border"></div>'+r.join(" "))[e.pages>1?"show":"hide"]()}},S.addSmilies=function(e,t){var s=S.smiliesTooltip;s&&s.el.find("ul.ds-smilies-tabs").append("<li><a>"+e+"</a></li>"),S.smilies[e]=t},se.SmiliesTooltip=function(){},se.SmiliesTooltip.prototype={render:function(){var e=this,s=e.el=H(ee.smiliesTooltip(L));return s.click(r).find("ul.ds-smilies-tabs").delegate("a","click",(function(){e.reset(this.innerHTML)})),s.find(".ds-smilies-container").delegate("img","click",(function(){var s=e.replybox,a=s.el.find("textarea"),r=a[0],i=r.value;if(t.selection){r.value=i.substring(0,a.data("ds-range-start"))+this.title+i.substring(a.data("ds-range-end"),i.length),r.value=r.value.replace(R.leave_a_message,""),r.focus();var n=t.selection.createRange();n.moveStart("character",a.data("ds-range-start")+this.title.length),n.collapse(),n.select()}else{var o=r.selectionStart+this.title.length;r.value=i.substring(0,r.selectionStart)+this.title+i.substring(r.selectionEnd),r.setSelectionRange(o,o)}s.hideSmilies(),r.focus()})),this},reset:function(e){var t=this.el.find("ul.ds-smilies-tabs");t.find("a.ds-current").removeClass("ds-current"),t.find("a").filter((function(){return this.innerHTML==e})).addClass("ds-current");var s="<ul>";return H.each(L[e],(function(t,a){var r=0===e.indexOf("微博")?"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/"+a.replace("_org","_thumb"):S.STATIC_URL+"/images/smilies/"+a;"https:"==document.location.protocol&&(r=(r=r.replace("http://","//nznlz6ohs.qnssl.com/")).replace("http://img.t.sinajs.cn/","//nznlz6ohs.qnssl.com/")),r=r.replace("_org.gif","_thumb.gif"),"WordPress"===e&&(t=" "+t+" "),s+='<li><img src="'+r+'" title="'+y(t)+'" /></li>'})),s+="</ul>",this.el.find(".ds-smilies-container").html(s),this}},ee.postPlaceholder=function(){return['<li class="ds-post ds-post-placeholder">',R.no_comments_yet,"</li>"].join("")};var Y=H('<div id="ds-bubble"><div class="ds-bubble-content"></div><div class="ds-arrow ds-arrow-down ds-arrow-border"></div><div class="ds-arrow ds-arrow-down"></div></div>'),X=Y.find(".ds-bubble-content").delegate("a.ds-ctx-open","click",(function(){var e={};e.post_id=X.attr("data-post-id"),z.get("posts/conversation",e,(function(e){function s(e,t){return ee.ctxPost({post:e,index:t})}C.log(H.map(e.response,s).join("\n")),t.el.find("ol"),t.el.find("ol").html(H.map(e.response,s).join("\n"))}));var t=E('<h2>查看对话</h2><ol id="ds-ctx"></ol>');return t.el.find(".ds-dialog").css("width","600px"),t.el.find(".ds-dialog-body").css({"max-height":"350px",_height:"350px","overflow-y":"auto","padding-top":"10px"}),!1})),K=bubbleOutTimer=0;Y.mouseenter(T).mouseleave(N),se.PostList=function(e){e&&(e.params&&(this.params=e.params),e.embedThread&&(this.embedThread=e.embedThread)),this.el=H('<ul class="ds-comments"></ul>')},se.PostList.prototype={url:"threads/listPosts",render:function(){return M.call(this.el,this.embedThread,this.embedThread.options),this},reset:function(e){var t=this.embedThread.options;this.el.html(e[0]?H.map(le.getJSON(e),(function(e){return ee.post({post:e,options:t})})).join(""):ee.postPlaceholder())},refetch:function(){var e=this,s=H(ee.indicator()).appendTo(t.body).fadeIn(200);e.el.fadeTo(200,.5),z.get(e.url,e.params,(function(t){le.set(t.parentPosts||t.relatedPosts),ce.set(t.users),e.reset(t.response),e.embedThread.paginator.reset(t.cursor),e.el.fadeTo(200,1),S.scrollTo(e.el),s.remove()}))}},se.EmbedThread=Q.extend({uri:"threads/listPosts",params:"thread-id local-thread-id source-thread-id thread-key category channel-key author-key author-id url limit order max-depth form-position container-url"+(v.match(/MSIE 6\.0/)?"":" title image thumbnail"),render:function(){var e=this.el;if("请将此处替换成文章在你的站点中的ID"===e.data("thread-key"))return alert("请设置正确的 data-thread-key 属性"),!1;e.attr("id","ds-thread").append(ee.waitingImg());var t=e.width(),s=e.data("url")||!e.attr("data-thread-id")&&H("link[rel=canonical]").attr("href");s?e.data("url",k(s)):e.data("container-url",h.href),t&&400>=t&&e.addClass("ds-narrow").data("max-depth",1)},updateCounter:function(e){function t(e){return e.substr(e.indexOf("}")+1)}var s={duoshuo:["comments",t(R.comments_multiple)||"评论"],repost:["reposts",t(R.reposts_multiple)||"转载"],weibo:["weibo_reposts",t(R.weibo_reposts_multiple)||"新浪微博"],qqt:["qqt_reposts",t(R.qqt_reposts_multiple)||"腾讯微博"]};for(var a in s)if(!e||e==a){var r=this.data[s[a][0]];this.el.find(".ds-comments-tab-"+a).html(this.el.hasClass("ds-narrow")?'<span class="ds-service-icon ds-'+a+'"></span>'+r:(r?'<span class="ds-highlight">'+r+"</span>":"0")+s[a][1])}},onError:function(e){this.el.html("评论框出错啦("+e.code+"): "+e.errorMessage)},onload:function(t){var a=this,r=a.threadId=t.thread.thread_id,n=t.cursor,o=a.options=t.options,d=a.innerEl=p(H('<div id="ds-reset"></div>').appendTo(a.el));a.model=new G(a.data=t.thread),le.set(t.parentPosts||t.relatedPosts),ce.set(t.users),a.el.find("#ds-waiting").remove(),o.like_thread_enabled&&(a.meta=new se.Meta(a),d.append(a.meta.render().el)),o.hot_posts&&t.hotPosts&&t.hotPosts.length&&(a.hotPosts=new se.HotPosts(H('<div class="ds-rounded"></div>'),{max_depth:1,show_context:o.show_context}),a.hotPosts.thread=a,d.append(a.hotPosts.el),a.hotPosts.onload({list:le.getJSON(t.hotPosts)})),a.postListHead=new se.PostListHead(a),a.postList=new se.PostList({embedThread:a,params:{source:"duoshuo",thread_id:r,max_depth:o.max_depth,order:o.order,limit:o.limit}}),a.postList.render().reset(t.response),a.paginator=new se.Paginator({collection:a.postList}),a.paginator.reset(n);var c=a.replybox=new se.Replybox(a);c.postList=a.postList.el,i()?a.loginButtons=H(ee.loginButtons()).delegate("a.ds-more-services","click",(function(){return a.loginButtons.find(".ds-additional-services").toggle(),!1})).delegate("a.ds-service-link","click",l):a.toolbar=H(ee.toolbar()).delegate(".ds-account-control","mouseenter",(function(){H(this).addClass("ds-active")})).delegate(".ds-account-control","mouseleave",(function(){H(this).removeClass("ds-active")})).delegate("a.ds-bind-more","click",(function(){return E(ee["dialog-bind-more"]()).el.find(".ds-dialog").addClass("ds-dialog-bind-more").css("width","300px").find("a.ds-service-link").click(l),!1})).delegate("a.ds-unread-comments-count","click",(function(){return w("unread-comments"),!1}));var u=['<a name="respond"></a>',a.toolbar||a.loginButtons,c.render().el];"top"==o.formPosition&&H.fn.append.apply(d,u),d.append(a.postListHead.render().el,a.postList.el,a.paginator.el),"bottom"==o.formPosition&&H.fn.append.apply(d,u),d.append(ee.poweredBy(o.poweredby_text)),a.updateCounter(),t.alerts&&H.each(t.alerts,(function(e,t){H('<div class="ds-alert">'+t+"</div>").insertBefore(a.toolbar||loginButtons)})),o.message&&c.el.find("textarea").val(o.message).focus(),oe.on("reset",(function(){var e=oe.data.comments||0;d.find("a.ds-unread-comments-count").html(e).attr("title",e?"你有"+e+"条新回复":"你没有新回复").css("display",e?"inline":"none")})),o.mzadx_id&&(S.require("mzadxN",(function(){})),H('<div id="MZADX_'+o.mzadx_id+'" style="margin:0 auto;"></div>').appendTo(d),__mz_rpq=e.__mz_rpq||[],__mz_rpq.push({l:[o.mzadx_id],r:"1",_srv:"MZADX",_callback:function(){}})),S.thread=a,oe.data!==s&&oe.trigger("reset"),i()||A.send({visit_thread_id:a.threadId})},onMessage:function(e){I(this.postList.el,new F(e),this.options)}}),se.HotPosts=Q.extend({tmpl:"hotPosts",params:"show-quote",render:function(){return this.el.attr("id","ds-hot-posts"),this},onload:function(e){e.options=H.extend(this.options,e.options),Q.prototype.onload.call(this,e),M.call(this.el.find("ul"),this.thread,this.options)}}),se.RecentComments=Q.extend({tmpl:"commentList",uri:"sites/listRecentPosts",params:"show-avatars show-time show-title avatar-size show-admin excerpt-length num-items channel-key",render:function(){this.el.attr("id","ds-recent-comments")},prepare:function(e){return{list:H.map(e.response,(function(e){return new F(e).toJSON()}))}}}),se.RecentVisitors=Q.extend({tmpl:"recentVisitors",uri:"sites/listVisitors",params:"show-time avatar-size num-items channel-key",render:function(){this.el.children().detach(),this.el.attr("id","ds-recent-visitors").append(this.waitingEl=H(ee.waitingImg()))}}),se.TopThreads=Q.extend({tmpl:"topThreads",uri:"sites/listTopThreads",params:"range num-items channel-key",render:function(){this.el.children().detach(),this.el.attr("id","ds-top-threads").append(this.waitingEl=H(ee.waitingImg()))}}),se.LoginWidget=Q.extend({tmpl:"loginWidget",render:function(){var e=this.el;e.attr("id","ds-login").html(ee.loginWidget(["weixin","weibo","qq","renren","kaixin","douban"])),e.find("a").click(l),e.find("a.ds-logout").attr("href",Z.logoutUrl())}}),se.ThreadCount=Q.extend({onload:function(e){var t=this.el,s=t.data("count-type")||"comments",a=e.data[s];t[t.data("replace")?"replaceWith":"html"](R[s+"_"+(a?a>1?"multiple":"one":"zero")].replace("{num}",a))}}),se.ShareWidget=Q.extend({tmpl:"shareWidget",render:function(){var e={copyright:"多说分享插件",services:["weibo","qzone","sohu","renren","netease","qqt","kaixin","douban","qq","meilishuo","mogujie","baidu","taobao","google","wechat","diandian","huaban","duitang","youdao","pengyou","facebook","twitter","linkedin","msn"]};this.el.attr("id","ds-share"),this.el.children().attr("id","ds-reset"),this.el.find(".ds-share-aside-inner").html(ee.shareWidget(e)),this.el.find(".ds-share-icons-more").html(ee.shareWidget(e)),this.el.find(".ds-share-icons-more").hide(),this.el.hasClass("flat")&&this.el.find("a").each((function(){H(this).addClass("flat")})),p(this.el),this.delegateEvents()},delegateEvents:function(){var s=this.el;if(s.children().hasClass("ds-share-inline")){var r=".ds-share-icons-more",i=s.find(r),n="[data-toggle=ds-share-icons-more]";s.delegate(n,"mouseover",(function(){i.show()})),s.delegate(n,"mouseout",(function(){i.hide()})),s.delegate(r,"mouseover",(function(){i.show()})),s.delegate(r,"mouseout",(function(){i.hide()}))}else{var d=s.children().hasClass("ds-share-aside-left")?"slide-to-right":"slide-to-left",l=s.children();if(!o.cssProperty("transition")){var c=s.children().hasClass("ds-share-aside-left")?"left":"right";s.delegate(".ds-share-aside-toggle","mouseover",(function(){var e={};O.ie6&&"right"===c?e.left=(t.documentElement.scrollLeft+t.documentElement.clientWidth-this.offsetWidth-(parseInt(this.currentStyle.marginLeft,10)||0)-parseInt(this.currentStyle.marginRight,10)||0)-195:e[c]=0,l.animate(e,200)})),s.delegate(".ds-share-aside-inner","mouseleave",(function(){var e={};O.ie6&&"right"===c?e.left=(t.documentElement.scrollLeft+t.documentElement.clientWidth-this.offsetWidth-(parseInt(this.currentStyle.marginLeft,10)||0)-parseInt(this.currentStyle.marginRight,10)||0)+230:e[c]=-229,l.animate(e,200)}))}s.delegate(".ds-share-aside-toggle,.ds-share-aside-inner","mouseover",(function(){l.addClass(d)})),s.delegate(".ds-share-aside-toggle,.ds-share-aside-inner","mouseleave",(function(){l.removeClass(d)}))}s.delegate("a","click",(function(t){var r=H(this).data("service");if(s.data("url")){if("wechat"===r){var i=a()+"/api/qrcode/getImage.png",n="?size=240&text="+s.data("url");E(ee["dialog-qrcode"]({qrcode_url:i+n,url:s.data("url")})).el.find(".ds-dialog").css("width","320px")}else{var d=a()+"/share-proxy/?"+o.param({service:H(this).data("service"),thread_key:s.data("threadKey"),title:s.data("title"),images:s.data("images"),content:s.data("content"),url:s.data("url")});e.open(d,"_blank")}t.preventDefault(),t.stopPropagation()}else alert("请设置data-url")}))}});var te=0;S.initSelector=function(e,t){var s=[];!q()||!H.isReady&&j||H(e).each((function(e,a){var r=H(a);if(!r.data("initialized")){r.data("initialized",!0);var i=new se[t.type](r,t);if(ae.push(i),"ThreadCount"===t.type){var n=r.attr("data-thread-key");r.attr("data-channel-key")&&(n=r.attr("data-channel-key")+":"+n),s.push(n),de[n]||(de[n]=new G({})),de[n].on("reset",(function(){i.onload(this)}))}else if(i.uri){var o={};H.each(i.params.split(" "),(function(e,t){o[t.replace(/-/g,"_")]=r.attr("data-"+t)||r.data(t)})),z.get(i.uri,U(o),(function(e){i.load(e)}))}}})),s.length&&z.get("threads/counts",U({threads:s.join(",")}),(function(e){W(e),o.extend(R,e.options),de.set(e.response)}))},(S.initView=function(){H.each(P,S.initSelector)})(),H((function(){if(!c){if(!q())return C.error("缺少 duoshuoQuery 的定义");C.warn("请在加载多说 embed.js 之前定义 duoshuoQuery")}setInterval((function(){H(".ds-time").each((function(){var e=H(this).attr("datetime");e&&(this.innerHTML=S.elapsedTime(e))}))}),2e4),c.ondomready&&c.ondomready(),S.initView(),!te&&c.short_name&&z.get("analytics/ping",U({}),W)}))}))}}(window,document);